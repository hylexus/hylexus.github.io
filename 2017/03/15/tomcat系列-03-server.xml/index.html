<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>tomcat系列-03-server.xml | 宛丘</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">tomcat系列-03-server.xml</h1><a id="logo" href="/.">宛丘</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">tomcat系列-03-server.xml</h1><div class="post-meta">Mar 15, 2017<span> | </span><span class="category"><a href="/categories/app-server/">app-server</a></span></div><div class="post-content"><p>本文将介绍tomcat配置文件server.xml中常用的节点配置。</p>
<h1 id="1-整体结构"><a href="#1-整体结构" class="headerlink" title="1 整体结构"></a>1 整体结构</h1><p>server.xml文件的整体结构其实和上一篇文章中我们所说的tomcat-体系结构图是对应的:</p>
<p><img src="http://img.blog.csdn.net/20160925154440526" alt="tomcat-体系结构图"></p>
<p>以下是一个包括常见元素的基础的server.xml配置:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8005"</span> <span class="attr">shutdown</span>=<span class="string">"SHUTDOWN"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.startup.VersionLoggerListener"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Listener</span> <span class="attr">SSLEngine</span>=<span class="string">"on"</span></span></div><div class="line"><span class="tag">		<span class="attr">className</span>=<span class="string">"org.apache.catalina.core.AprLifecycleListener"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.JasperListener"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.JreMemoryLeakPreventionListener"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.ThreadLocalLeakPreventionListener"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">GlobalNamingResources</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">Resource</span> <span class="attr">auth</span>=<span class="string">"Container"</span> <span class="attr">description</span>=<span class="string">"User database that can be updated and saved"</span></span></div><div class="line"><span class="tag">			<span class="attr">factory</span>=<span class="string">"org.apache.catalina.users.MemoryUserDatabaseFactory"</span> <span class="attr">name</span>=<span class="string">"UserDatabase"</span></span></div><div class="line"><span class="tag">			<span class="attr">pathname</span>=<span class="string">"conf/tomcat-users.xml"</span> <span class="attr">type</span>=<span class="string">"org.apache.catalina.UserDatabase"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">GlobalNamingResources</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></div><div class="line"><span class="tag">			<span class="attr">port</span>=<span class="string">"80"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8009"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">Engine</span> <span class="attr">defaultHost</span>=<span class="string">"localhost"</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.realm.LockOutRealm"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.realm.UserDatabaseRealm"</span></span></div><div class="line"><span class="tag">					<span class="attr">resourceName</span>=<span class="string">"UserDatabase"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">Realm</span>&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;<span class="name">Host</span> <span class="attr">appBase</span>=<span class="string">"webapps"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span> <span class="attr">name</span>=<span class="string">"localhost"</span></span></div><div class="line"><span class="tag">				<span class="attr">unpackWARs</span>=<span class="string">"true"</span>&gt;</span></div><div class="line"></div><div class="line">				<span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.AccessLogValve"</span></span></div><div class="line"><span class="tag">					<span class="attr">directory</span>=<span class="string">"logs"</span> <span class="attr">pattern</span>=<span class="string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> <span class="attr">prefix</span>=<span class="string">"localhost_access_log."</span></span></div><div class="line"><span class="tag">					<span class="attr">suffix</span>=<span class="string">".txt"</span> /&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;/<span class="name">Host</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">Service</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="2-Server节点"><a href="#2-Server节点" class="headerlink" title="2 Server节点"></a>2 Server节点</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8005"</span> <span class="attr">shutdown</span>=<span class="string">"SHUTDOWN"</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- .......  --&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这会让Tomcat启动一个server实例（即一个JVM），它监听在8005端口以接收shutdown命令。<br>各Server的定义不能使用同一个端口，这意味着如果在同一个物理机上启动了多个Server实例，必须配置它们使用不同的端口。<br>管理员可以直接telnet至此端口使用SHUTDOWN命令关闭此实例。不过，基于安全角度的考虑，这通常不允许远程进行.<br>其实server节点就是代表tomcat自己了。</p>
<blockquote>
<p>Server的相关属性</p>
</blockquote>
<ul>
<li>className: 用于实现此Server容器的完全限定类的名称，默认为org.apache.catalina.core.StandardServer；</li>
<li>port: 接收shutdown指令的端口，默认仅允许通过本机访问，默认为8005；</li>
<li>shutdown：发往此Server用于实现关闭tomcat实例的命令字符串，默认为SHUTDOWN；</li>
<li>server.xml文件中只能有一个Server节点</li>
</ul>
<h1 id="3-Listener"><a href="#3-Listener" class="headerlink" title="3 Listener"></a>3 Listener</h1><p><strong> 注意：此处的server.xml中的Listener和部署描述符web.xml文件中的Listener并不是一回事。</strong></p>
<h1 id="4-Service节点"><a href="#4-Service节点" class="headerlink" title="4 Service节点"></a>4 Service节点</h1><ul>
<li>关联一个引擎和与此引擎相关的连接器，每个连接器通过一个特定的端口和协议接收入站请求交将其转发至关联的引擎进行处理。</li>
<li>Service应该包含一个引擎(Engine)、一个或多个连接器(Connector)。</li>
<li>在一定意义上，可以将Service理解为Engine和Connector的粘合剂、关联器、或者说是盛放他们的”容器”。</li>
<li>一般很少有需要去直接更改Service节点属性</li>
</ul>
<h2 id="4-1-Connector"><a href="#4-1-Connector" class="headerlink" title="4.1 Connector"></a>4.1 Connector</h2><h3 id="4-1-1-Connector类型"><a href="#4-1-1-Connector类型" class="headerlink" title="4.1.1 Connector类型"></a>4.1.1 Connector类型</h3><ul>
<li>HTTP连接器</li>
<li>SSL连接器</li>
<li>AJP 1.3连接器</li>
<li>proxy连接器</li>
</ul>
<h3 id="4-1-2-Connector常见属性"><a href="#4-1-2-Connector常见属性" class="headerlink" title="4.1.2 Connector常见属性"></a>4.1.2 Connector常见属性</h3><ul>
<li>address：指定连接器监听的地址，默认为所有地址，即0.0.0.0；</li>
<li>maxThreads：支持的最大并发连接数，默认为200；</li>
<li>port：监听的端口，默认为0；</li>
<li>protocol：连接器使用的协议，默认为HTTP/1.1，定义AJP协议时通常为AJP/1.3；</li>
<li>redirectPort：如果某连接器支持的协议是HTTP，当接收客户端发来的HTTPS请求时，则转发至此属性定义的端口；</li>
<li>connectionTimeout：等待客户端发送请求的超时时间，单位为毫秒，默认为60000，即1分钟；</li>
<li>connectionUploadTimeout:……………………</li>
<li>keepAliveTimeout:…………………………</li>
<li>enableLookups：是否通过request.getRemoteHost()进行DNS查询以获取客户端的主机名；默认为true；</li>
<li>acceptCount：设置等待队列的最大长度；通常在tomcat所有处理线程均处于繁忙状态时，新发来的请求将被放置于等待队列中；</li>
<li>excutor：Excutor的唯一的名称，详见下文的Excutor</li>
<li>maxHttpHeaderSize：允许的最大请求头大小(8192 bytes—8kB)</li>
<li>maxKeepAliveRequests：每个Keep-Alive的HTTP连接允许完成的最大请求数</li>
<li>scheme：是<code>request.getScheme()</code>的返回值<ul>
<li>HTTP-Connector应该设置为http</li>
<li>SSL-Connector应该设置为https</li>
</ul>
</li>
<li>secure:是<code>request.isSecure()</code>的返回值<ul>
<li>HTTP-Connector应该设置为false</li>
<li>SSL-Connector应该设置为true</li>
</ul>
</li>
<li>SSLEnabled:是否在Connector上启用SSL，默认false</li>
<li>SSLProtocol:使用的SSL/TLS版本    </li>
<li>URIEncoding:URL字符集，比如UTF-8</li>
<li>useBodyEncodingForURI：……</li>
<li>useIPVHosts:Connector是否基于IP的虚拟主机</li>
</ul>
<h3 id="4-1-3-几种Connector示例"><a href="#4-1-3-几种Connector示例" class="headerlink" title="4.1.3 几种Connector示例"></a>4.1.3 几种Connector示例</h3><blockquote>
<p>HTTP connector 示例</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></div><div class="line"><span class="tag">      <span class="attr">maxThreads</span>=<span class="string">"150"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></div><div class="line"><span class="tag">      <span class="attr">redirectPort</span>=<span class="string">"8443"</span> <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span>/&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>SSL connector 示例</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8443"</span></span></div><div class="line"><span class="tag">    <span class="attr">maxThreads</span>=<span class="string">"150"</span> <span class="attr">minSpareThreads</span>=<span class="string">"25"</span> <span class="attr">maxSpareThreads</span>=<span class="string">"75"</span></span></div><div class="line"><span class="tag">    <span class="attr">enableLookups</span>=<span class="string">"false"</span> <span class="attr">acceptCount</span>=<span class="string">"100"</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">scheme</span>=<span class="string">"https"</span> <span class="attr">secure</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">    <span class="attr">clientAuth</span>=<span class="string">"false"</span> <span class="attr">sslProtocol</span>=<span class="string">"TLS"</span> /&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>AJP connector 示例</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8009"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="4-2-Executor"><a href="#4-2-Executor" class="headerlink" title="4.2 Executor"></a>4.2 Executor</h2><p>可以通过Excutor为同一个Service的所有Connector配置一个共享线程池。<br>在多个Connector的状况下，这样处理非常有用，多个Connector共享一个线程池。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">Executor</span> <span class="attr">name</span>=<span class="string">"tomcatThreadPool"</span> <span class="attr">namePrefix</span>=<span class="string">"catalina-exec-"</span></span></div><div class="line"><span class="tag">	    <span class="attr">maxThreads</span>=<span class="string">"150"</span> <span class="attr">minSpareThreads</span>=<span class="string">"4"</span>/&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">Connector</span> <span class="attr">executor</span>=<span class="string">"tomcatThreadPool"</span> <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span> </span></div><div class="line"><span class="tag">				 <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">port</span>=<span class="string">"80"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> </span></div><div class="line"><span class="tag">				 <span class="attr">redirectPort</span>=<span class="string">"8443"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Service</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Excutor的详细参数配置请点击<a href="http://tomcat.apache.org/tomcat-7.0-doc/config/executor.html" target="_blank" rel="external">这里看官网文档</a></p>
<h2 id="4-3-Engine节点"><a href="#4-3-Engine节点" class="headerlink" title="4.3 Engine节点"></a>4.3 Engine节点</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Engine</span> <span class="attr">name</span>=<span class="string">"Catalina"</span> <span class="attr">defaultHost</span>=<span class="string">"localhost"</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Engine是Servlet处理器的一个实例，即servlet引擎。<br>Engine容器中可以包含Realm、Host、Listener和Valve子容器。</p>
<h3 id="4-3-1-Engine常见属性"><a href="#4-3-1-Engine常见属性" class="headerlink" title="4.3.1 Engine常见属性"></a>4.3.1 Engine常见属性</h3><ul>
<li>baseDir：基目录</li>
<li>defaultHost<ul>
<li>表示当连接器收到一个发往非明确定义虚拟主机的请求时，将请求发往哪个默认的虚拟主机。</li>
<li>在Engine中定义的多个虚拟主机的主机名称中至少要有一个跟defaultHost定义的主机名称同名。</li>
</ul>
</li>
<li>name<ul>
<li>Engine组件的名称，用于日志和错误信息记录时区别不同的引擎</li>
<li>该属性还决定了 ${CATALINA_BASE}/conf/XXX的目录名，比如/soft/tomcat-7.0.72-80/conf/Catalina</li>
</ul>
</li>
<li>jvmRoute:可以理解为在负载均衡中tomcat实例的唯一标记属性</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Engine</span> <span class="attr">defaultHost</span>=<span class="string">"localhost"</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!--此处应该至少有一个名为localhost的Host节点--&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="4-3-2-Host节点"><a href="#4-3-2-Host节点" class="headerlink" title="4.3.2 Host节点"></a>4.3.2 Host节点</h3><p>Host节点代表一个虚拟主机，类似于Nginx中的server指令。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"localhost"</span> <span class="attr">appBase</span>=<span class="string">"webapps"</span></span></div><div class="line"><span class="tag">	<span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">	<span class="attr">xmlValidation</span>=<span class="string">"false"</span> <span class="attr">xmlNamespaceAware</span>=<span class="string">"false"</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- host...  --&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>name：虚拟主机的名称，必须唯一</li>
<li>appBase:比如webapps目录，即存放web应用程序的目录.可以使用基于$CATALINA_HOME的相对路径</li>
<li>autoDeploy:自动热部署</li>
<li>deployOnStartup：在tomcat启动时是否自动解压war包,默认为true</li>
<li>unpackWars:在启用此webapps时是否对WAR格式的归档文件先进行展开</li>
<li>errorReportValveClass：对于错误页的处理类,默认为:<code>org.apache.catalina.valves.ErrorReportValve</code></li>
<li>xmlValidation：xml校验</li>
<li>xmlNamespaceAware：xml校验</li>
</ul>
<h3 id="4-3-3-Context节点"><a href="#4-3-3-Context节点" class="headerlink" title="4.3.3 Context节点"></a>4.3.3 Context节点</h3><p>一个Context定义用于标识tomcat实例中的一个Web应用程序</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">appBase</span>=<span class="string">"webapps"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span> <span class="attr">name</span>=<span class="string">"localhost"</span></span></div><div class="line"><span class="tag">	<span class="attr">unpackWARs</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.AccessLogValve"</span></span></div><div class="line"><span class="tag">		<span class="attr">directory</span>=<span class="string">"logs"</span> <span class="attr">pattern</span>=<span class="string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> </span></div><div class="line"><span class="tag">		<span class="attr">prefix</span>=<span class="string">"localhost_access_log."</span></span></div><div class="line"><span class="tag">		<span class="attr">suffix</span>=<span class="string">".txt"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"web-1"</span> <span class="attr">path</span>=<span class="string">"/web-1"</span> <span class="attr">reloadable</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">		<span class="attr">source</span>=<span class="string">"org.eclipse.jst.jee.server:web-1"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"ROOT"</span> <span class="attr">path</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>docBase<ul>
<li>相应的Web应用程序的存放位置；也可以使用相对路径，起始路径为此Context所属Host中appBase定义的路径；</li>
<li>docBase的路径名不能与相应的Host中appBase中定义的路径名有包含关系，比如，如果appBase为deploy，而docBase绝不能为deploy-bbs类的名字</li>
</ul>
</li>
<li>path : 相对于Web服务器根路径而言的URI,如果为空””，则表示为webapp的根路径</li>
<li>reloadable : 是否允许重新加载此context相关的Web应用程序的类</li>
<li>antiJARLocking:避免在windows上锁定JAR，默认false</li>
<li>antiResourceLocking:避免在windows上锁定资源，默认false</li>
<li>cachingAllowd:是否允许静态资源缓存，默认为true</li>
<li>cacheMaxSize：该Context的最大静态资源缓存值(KB)</li>
<li>cacheTTL:Time To Live(second)</li>
<li>caseSensitive:是否区分URL大小写，默认为true</li>
<li>cookies：是否启用和该应用对应的会话的cookie支持，默认为true</li>
<li>unloadDelay：在unload时的延迟时间</li>
<li>unpackWAR：是否自动解压war包，默认为true</li>
</ul>
<h3 id="4-3-4-WatchedResource"><a href="#4-3-4-WatchedResource" class="headerlink" title="4.3.4 WatchedResource"></a>4.3.4 WatchedResource</h3><p>定义被监控的程序清单。<br>比如web.xml被修改时应用会自动重新加载，就是因为web.xml文件在${CATALINA_HOME}/conf/context.xml文件中被标记为一个WatchedResource。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"web-1"</span> <span class="attr">path</span>=<span class="string">"/web-1"</span> <span class="attr">reloadable</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">	<span class="attr">source</span>=<span class="string">"org.eclipse.jst.jee.server:web-1"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">WatchedResource</span>&gt;</span>WEB-INF/log4j.xml<span class="tag">&lt;/<span class="name">WatchedResource</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="4-3-5-Realm"><a href="#4-3-5-Realm" class="headerlink" title="4.3.5 Realm"></a>4.3.5 Realm</h3><p>Realm和认证授权相关。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Engine</span> <span class="attr">defaultHost</span>=<span class="string">"localhost"</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.realm.UserDatabaseRealm"</span></span></div><div class="line"><span class="tag">			<span class="attr">resourceName</span>=<span class="string">"UserDatabase"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">Realm</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="5-GlobalNamingResources节点"><a href="#5-GlobalNamingResources节点" class="headerlink" title="5 GlobalNamingResources节点"></a>5 GlobalNamingResources节点</h1><p>应用于整个服务器的JNDI映射，此可以避免每个Web应用程序都需要在各自的web.xml创建，这在web应用程序以WAR的形式存在时尤为有用。它通常可以包含三个子元素：</p>
<ul>
<li>Environment: 取代web.xml中的<code>env-entry</code></li>
<li>Resource：取代web.xml中的<code>esource-ref</code></li>
<li>ResourceEnvRef：取代web.xml中的<code>resource-env-ref</code></li>
</ul>
<h1 id="6-Manager"><a href="#6-Manager" class="headerlink" title="6 Manager"></a>6 Manager</h1><p>Manger对象用于实现HTTP会话管理的功能</p>
<ul>
<li>StandardManager<ul>
<li>Tomcat6的默认会话管理器，用于非集群环境中对单个处于运行状态的Tomcat实例会话进行管理。</li>
<li>当Tomcat关闭时，这些会话相关的数据会被写入磁盘上的一个名叫SESSION.ser的文件，并在Tomcat下次启动时读取此文件。</li>
</ul>
</li>
<li>PersistentManager<ul>
<li>当一个会话长时间处于空闲状态时会被写入到swap会话对象，这对于内存资源比较吃紧的应用环境来说比较有用。</li>
</ul>
</li>
<li>DeltaManager<ul>
<li>于Tomcat集群的会话管理器，它通过将改变了会话数据同步给集群中的其它节点实现会话复制。</li>
<li>这种实现会将所有会话的改变同步给集群中的每一个节点，也是在集群环境中用得最多的一种实现方式。</li>
</ul>
</li>
<li>BackupManager<ul>
<li>用于Tomcat集群的会话管理器，与DeltaManager不同的是，某节点会话的改变只会同步给集群中的另一个而非所有节点。</li>
</ul>
</li>
</ul>
<h1 id="7-Valve"><a href="#7-Valve" class="headerlink" title="7 Valve"></a>7 Valve</h1><ul>
<li>Valve用来拦截请求并在将其转至目标之前进行某种处理操作，类似于Servlet规范中定义的过滤器。</li>
<li>Valve可以定义在任何容器类的组件中。Valve常被用来记录客户端请求、客户端IP地址和服务器等信息，这种处理技术通常被称作请求转储(request dumping)。</li>
<li>请求转储valve记录请求客户端请求数据包中的HTTP首部信息和cookie信息文件中，响应转储valve则记录响应数据包首部信息和cookie信息至文件中。</li>
</ul>
<p>有关Value的详细配置请看<a href="https://tomcat.apache.org/tomcat-7.0-doc/config/valve.html" target="_blank" rel="external">官方文档</a></p>
<p>不知不觉就码了这么多字符…………以后有时间再写有关Valve的文章吧……</p>
</div><div class="tags"><a href="/tags/tomcat/">tomcat</a></div><div class="post-nav"><a href="/2017/03/15/tomcat系列-02-基础操作/" class="pre">tomcat系列-02-基础操作</a><a href="/2017/03/15/tomcat系列-04-启用APR/" class="next">tomcat系列-04-启用APR</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/99-problems-in-scala/">99-problems-in-scala</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-多线程/">Java-多线程</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaSE/">JavaSE</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode/">LeetCode</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NIO/">NIO</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/app-server/">app-server</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/http-server/">http-server</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/logging/">logging</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring-cloud/">spring-cloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/排序/">排序</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/LeetCode/" style="font-size: 15px;">LeetCode</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/apache-httpd/" style="font-size: 15px;">apache/httpd</a> <a href="/tags/lambda/" style="font-size: 15px;">lambda</a> <a href="/tags/bit/" style="font-size: 15px;">bit</a> <a href="/tags/keytool/" style="font-size: 15px;">keytool</a> <a href="/tags/非对称加密/" style="font-size: 15px;">非对称加密</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/jt-808/" style="font-size: 15px;">jt-808</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/logging/" style="font-size: 15px;">logging</a> <a href="/tags/scala/" style="font-size: 15px;">scala</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/spring-cloud/" style="font-size: 15px;">spring-cloud</a> <a href="/tags/ssh/" style="font-size: 15px;">ssh</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/排序/" style="font-size: 15px;">排序</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/java多线程-01-基本概念/">java多线程-01-基本概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/排序算法-01-冒泡排序/">排序算法-01-冒泡排序排序算法-01-冒泡排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/git-01-简介、安装和配置/">git-01-简介、安装和配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/git-02-基本操作/">git-02-基本操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/git-03-分支/">git-03-分支</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/shiro-常用filter/">shiro-常用filter</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/problem01-05/">problem01-05</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/java秘钥、证书管理工具-keytool/">java秘钥、证书管理工具-keytool</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/docker筑基篇-00-docker简介/">docker筑基篇-00-docker简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/httpd系列-00-安装/">httpd系列-00-安装</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">宛丘.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>
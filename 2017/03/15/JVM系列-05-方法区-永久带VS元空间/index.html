<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>JVM系列-05-方法区-永久带VS元空间 | 宛丘</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">JVM系列-05-方法区-永久带VS元空间</h1><a id="logo" href="/.">宛丘</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">JVM系列-05-方法区-永久带VS元空间</h1><div class="post-meta">Mar 15, 2017<span> | </span><span class="category"><a href="/categories/JVM/">JVM</a></span></div><div class="post-content"><h1 id="1-JVM-HotSpot-内存模型"><a href="#1-JVM-HotSpot-内存模型" class="headerlink" title="1 JVM(HotSpot)内存模型"></a>1 JVM(HotSpot)内存模型</h1><p><img src="http://img.blog.csdn.net/20161220214119928?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHlsZXh1cw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="HotSpot虚拟机内存模型"></p>
<p>上面这种图是HotSpot虚拟机的内存模型，本篇文章主要介绍方法区。<br>因为方法区在JDK1.7及其以前版本中的实现方式——<code>永久带</code>在JKD8中被移除了。</p>
<p>至于其他部分不太了解的可以阅读这篇文章：<a href="http://blog.csdn.net/hylexus/article/details/53564865" target="_blank" rel="external">http://blog.csdn.net/hylexus/article/details/53564865</a></p>
<h1 id="2-官方对方法区的介绍"><a href="#2-官方对方法区的介绍" class="headerlink" title="2 官方对方法区的介绍"></a>2 官方对方法区的介绍</h1><blockquote>
<p>以下是《Java虚拟机规范(JavaSE7)》一书中对方法区的描述：</p>
</blockquote>
<p>在 Java 虚拟机中，方法区（ Method Area） 是可供各条<code>线程共享</code>的<code>运行时内存区域</code>。方法区与传统语言中的编译代码储存区（ Storage Area Of Compiled Code）或者操作系统进程的正文段（ Text egment）的作用非常类似，它<code>存储了每一个类的结构信息</code>，例如运行时常量池（ Runtime Constant Pool）、字段和方法数据、构造函数和普通方法的字节码内容、还包括一些在类、实例、接口初始化时用到的特殊方法（ §2.9）。</p>
<p>方法区在虚拟机启动的时候被创建，虽然<code>方法区是堆的逻辑组成部分</code>，但是简单的虚拟机实现可以选择在这个区域不实现垃圾收集。这个版本的 Java 虚拟机规范也不限定实现方法区的内存位置和编译代码的管理策略。方法区的容量可以是固定大小的，也可以随着程序执行的需求动态扩展，并在不需要过多空间时自动收缩。方法区在实际内存空间中可以是不连续的。</p>
<p>Java 虚拟机实现应当提供给程序员或者最终用户调节方法区初始容量的手段，对于可以动态扩展和收缩方法区来说，则应当提供调节其最大、最小容量的手段</p>
<p>如果方法区的内存空间不能满足内存分配请求，那 Java 虚拟机将抛出一个<code>OutOfMemoryError</code>异常。</p>
<hr>

<p>总之，就是用来存储类的描述信息——元数据的。它有一个别名叫做Non-Heap（非堆）。</p>
<h1 id="3-常说的永久带和方法区是什么关系？"><a href="#3-常说的永久带和方法区是什么关系？" class="headerlink" title="3 常说的永久带和方法区是什么关系？"></a>3 常说的永久带和方法区是什么关系？</h1><p>平时，说到永久带(<code>PermGen space</code>)的时候往往将其和方法区不加区别。这么理解在一定角度也说的过去。<br>因为，《Java虚拟机规范》只是规定了有方法区这么个概念和它的作用，并没有规定如何去实现它。那么，在不同的 JVM 上方法区的实现肯定是不同的了。<br>同时，大多数用的JVM都是Sun公司的HotSpot。在HotSpot上把GC分代收集扩展至方法区，或者说使用永久代来实现方法区。</p>
<p>虽然可以牵强的解释这种将方法区和永久带等同对待观点。但最终方法区和永久带还是不同的。一个是标准一个是实现。这就相当于你将java中的接口和接口的实现等同对待了一样。<br>同时，这种牵强的解释也仅仅是在HotSpot虚拟机上才能勉强成立。其他的虚拟机实现并没有永久带这一说法。<br>有人说，HotSpot之所以用永久带来实现方法区是因为这样可以不必专门为方法区编写一套内存管理的代码。</p>
<blockquote>
<p>大小调节</p>
</blockquote>
<p>在1.7之前，可以使用如下参数来调节方法区的大小</p>
<ul>
<li>-XX:PermSize <ul>
<li>方法区初始大小</li>
</ul>
</li>
<li>-XX:MaxPermSize <ul>
<li>方法区最大大小</li>
<li>超过这个值将会抛出<code>OutOfMemoryError</code>异常:java.lang.OutOfMemoryError: PermGen</li>
</ul>
</li>
</ul>
<h1 id="4-jdk8中的方法区"><a href="#4-jdk8中的方法区" class="headerlink" title="4 jdk8中的方法区"></a>4 jdk8中的方法区</h1><p>在jdk8中已经将永久带移除了。也就是说<code>-XX:PermSize</code>这些参数在jdk8中将是无效的。<br>移除了，肯定有人来代替他。就是新出现的元空间(Metaspace)来代替原来的永久带。</p>
<p>上文也提到了，方法区中主要存放的是一些描述性信息，即元数据。元空间这个名字起得还是挺形象的，至少比原来的永久带要更加见名之意了。</p>
<p>《Java虚拟机规范(JavaSE7)》中也说了<code>方法区是堆的逻辑组成部分</code>。<br>实际上JDK1.7中，存储在永久代的部分数据就已经转移到了<code>Java Heap</code>或者是 <code>Native Heap</code>。但永久代仍存在于JDK1.7中，但是并没完全移除。</p>
<blockquote>
<p>大小调节</p>
</blockquote>
<p>在1.8中，可以使用如下参数来调节方法区的大小</p>
<ul>
<li>-XX:MetaspaceSize<ul>
<li>元空间初始大小</li>
</ul>
</li>
<li>-XX:MaxMetaspaceSize <ul>
<li>元空间最大大小</li>
<li>超过这个值将会抛出<code>OutOfMemoryError</code>异常:java.lang.OutOfMemoryError: Metadata space</li>
<li>在jdk1.7中抛出的异常是这样:java.lang.OutOfMemoryError: PermGen</li>
</ul>
</li>
</ul>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li>《深入理解JVM》</li>
<li>《Java虚拟机规范(JavaSE7)》</li>
<li>《Java虚拟机规范(JavaSE8)》</li>
</ul>
</div><div class="tags"><a href="/tags/JVM/">JVM</a></div><div class="post-nav"><a href="/2017/03/15/problem16-20/" class="pre">problem16-20</a><a href="/2017/03/15/tomcat系列-02-基础操作/" class="next">tomcat系列-02-基础操作</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/99-problems-in-scala/">99-problems-in-scala</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-多线程/">Java-多线程</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaSE/">JavaSE</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode/">LeetCode</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NIO/">NIO</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/app-server/">app-server</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/http-server/">http-server</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/logging/">logging</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring-cloud/">spring-cloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/排序/">排序</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/logging/" style="font-size: 15px;">logging</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/jt-808/" style="font-size: 15px;">jt-808</a> <a href="/tags/LeetCode/" style="font-size: 15px;">LeetCode</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/apache-httpd/" style="font-size: 15px;">apache/httpd</a> <a href="/tags/lambda/" style="font-size: 15px;">lambda</a> <a href="/tags/bit/" style="font-size: 15px;">bit</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/keytool/" style="font-size: 15px;">keytool</a> <a href="/tags/非对称加密/" style="font-size: 15px;">非对称加密</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/scala/" style="font-size: 15px;">scala</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/spring-cloud/" style="font-size: 15px;">spring-cloud</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a> <a href="/tags/ssh/" style="font-size: 15px;">ssh</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/排序/" style="font-size: 15px;">排序</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/java多线程-01-基本概念/">java多线程-01-基本概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/排序算法-01-冒泡排序/">排序算法-01-冒泡排序排序算法-01-冒泡排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/常见加密类型及通信安全/">常见加密类型及通信安全</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/git-01-简介、安装和配置/">git-01-简介、安装和配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/httpd系列-00-安装/">httpd系列-00-安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/shiro-常用filter/">shiro-常用filter</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/httpd系列-04-基于openSSL配置HTTPS/">httpd系列-04-基于openSSL配置HTTPS</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/problem01-05/">problem01-05</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/java秘钥、证书管理工具-keytool/">java秘钥、证书管理工具-keytool</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/git-02-基本操作/">git-02-基本操作</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">宛丘.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>
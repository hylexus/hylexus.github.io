<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>java8-02-Stream-API | 宛丘</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">java8-02-Stream-API</h1><a id="logo" href="/.">宛丘</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">java8-02-Stream-API</h1><div class="post-meta">Jul 25, 2017<span> | </span><span class="category"><a href="/categories/JavaSE/">JavaSE</a></span></div><div class="post-content"><h1 id="0-Stream简介"><a href="#0-Stream简介" class="headerlink" title="0 Stream简介"></a>0 Stream简介</h1><ul>
<li>家庭住址 ：<code>java.util.stream.Stream&lt;T&gt;</code></li>
<li>出生年月：Java8问世的时候他就来到了世上</li>
<li>主要技能：那可以吹上三天三夜了……</li>
<li>主要特征<ul>
<li>不改变输入源</li>
<li>中间的各种操作是<code>lazy</code>的(惰性求值、延迟操作)</li>
<li>只有当开始消费流的时候，流才有意义</li>
<li>隐式迭代</li>
</ul>
</li>
<li>……</li>
</ul>
<p>总体感觉，<code>Stream</code>相当于一个进化版的<code>Iterator</code>。Java8源码里是这么注释的：</p>
<blockquote>
<p>  A sequence of elements supporting sequential and parallel aggregate operations</p>
</blockquote>
<p>可以方便的对集合进行遍历、过滤、映射、汇聚、切片等复杂操作。最终<code>汇聚</code>成一个新的Stream，<code>不改变原始数据</code>。并且各种复杂的操作都是<code>lazy</code>的，也就是说会尽可能的将所有的中间操作在最终的汇聚操作一次性完成。</p>
<p>比起传统的<code>对象和数据的操作</code>，Stream更专注于对<code>流的计算</code>,和传说中的函数式编程有点类似。</p>
<p>他具体进化的多牛逼，自己体验吧。</p>
<p>给一组输入数据:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="keyword">null</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="keyword">null</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="keyword">null</span>, <span class="number">2</span>, <span class="number">0</span>);</div></pre></td></tr></table></figure>
<p>求输入序列中非空奇数之和，并且相同奇数算作同一个。</p>
<ul>
<li>在lambda还在娘胎里的时候，为了实现这个功能，可能会这么做</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> s = <span class="number">0</span>;</div><div class="line"><span class="comment">// 先放在Set里去重</span></div><div class="line">Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;(list);</div><div class="line"><span class="keyword">for</span> (Integer i : set) &#123;</div><div class="line">  <span class="keyword">if</span> (i != <span class="keyword">null</span> &amp;&amp; (i &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123;</div><div class="line">    s += i;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">System.out.println(s);</div></pre></td></tr></table></figure>
<ul>
<li>当<code>lambda</code>和<code>Stream</code>双剑合璧之后：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> sum = list.stream().filter(e -&gt; e != <span class="keyword">null</span> &amp;&amp; (e &amp; <span class="number">1</span>) == <span class="number">1</span>).distinct().mapToInt(i -&gt; i).sum();</div></pre></td></tr></table></figure>
<h1 id="1-获取Stream"><a href="#1-获取Stream" class="headerlink" title="1 获取Stream"></a>1 获取Stream</h1><ul>
<li>从lambda的其他好基友那里获取Stream</li>
</ul>
<p>从1.8开始，接口中也可以存在 <code>default</code> 修饰的方法了。</p>
<blockquote>
<p>   <code>java.util.Collection&lt;E&gt;</code> 中有如下声明：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Iterable</span>&lt;<span class="title">E</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">// 获取普通的流</span></div><div class="line">    <span class="function"><span class="keyword">default</span> Stream&lt;E&gt; <span class="title">stream</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> StreamSupport.stream(spliterator(), <span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 获取并行流</span></div><div class="line">    <span class="function"><span class="keyword">default</span> Stream&lt;E&gt; <span class="title">parallelStream</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> StreamSupport.stream(spliterator(), <span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>  <code>java.util.Arrays</code>中有如下声明：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Stream&lt;T&gt; <span class="title">stream</span><span class="params">(T[] array)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> stream(array, <span class="number">0</span>, array.length);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title">stream</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> stream(array, <span class="number">0</span>, array.length);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 其他类似的方法不再一一列出</span></div></pre></td></tr></table></figure>
<blockquote>
<p>  示例</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; strs = Arrays.asList(<span class="string">"apache"</span>, <span class="string">"spark"</span>);</div><div class="line">Stream&lt;String&gt; stringStream = strs.stream();</div><div class="line"></div><div class="line">IntStream intStream = Arrays.stream(<span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">1</span>, <span class="number">25</span>, <span class="number">4</span>, <span class="number">2</span> &#125;);</div></pre></td></tr></table></figure>
<ul>
<li>通过Stream接口获取</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Stream&lt;String&gt; stream = Stream.of(<span class="string">"hello"</span>, <span class="string">"world"</span>);</div><div class="line">Stream&lt;String&gt; stream2 = Stream.of(<span class="string">"haha"</span>);</div><div class="line">Stream&lt;HouseInfo&gt; stream3 = Stream.of(<span class="keyword">new</span> HouseInfo[] &#123; <span class="keyword">new</span> HouseInfo(), <span class="keyword">new</span> HouseInfo() &#125;);</div><div class="line"></div><div class="line">Stream&lt;Integer&gt; stream4 = Stream.iterate(<span class="number">1</span>, i -&gt; <span class="number">2</span> * i + <span class="number">1</span>);</div><div class="line"></div><div class="line">Stream&lt;Double&gt; stream5 = Stream.generate(() -&gt; Math.random());</div></pre></td></tr></table></figure>
<p>注意：<code>Stream.iterate()</code>和 <code>Stream.generate()</code>生成的是<code>无限流</code>，一般要手动<code>limit</code> 。</p>
<h1 id="2-转换Stream"><a href="#2-转换Stream" class="headerlink" title="2 转换Stream"></a>2 转换Stream</h1><h2 id="流过滤、流切片"><a href="#流过滤、流切片" class="headerlink" title="流过滤、流切片"></a>流过滤、流切片</h2><p>这部分相对来说还算简单明了，看个例子就够了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取流</span></div><div class="line">Stream&lt;String&gt; stream = Stream.of(<span class="comment">//</span></div><div class="line">    <span class="keyword">null</span>, <span class="string">"apache"</span>, <span class="keyword">null</span>, <span class="string">"apache"</span>, <span class="string">"apache"</span>, <span class="comment">//</span></div><div class="line">    <span class="string">"github"</span>, <span class="string">"docker"</span>, <span class="string">"java"</span>, <span class="comment">//</span></div><div class="line">    <span class="string">"hadoop"</span>, <span class="string">"linux"</span>, <span class="string">"spark"</span>, <span class="string">"alifafa"</span>);</div><div class="line"></div><div class="line">stream<span class="comment">// 去除null,保留包含a的字符串</span></div><div class="line">    .filter(e -&gt; e != <span class="keyword">null</span> &amp;&amp; e.contains(<span class="string">"a"</span>))<span class="comment">//</span></div><div class="line">    .distinct()<span class="comment">// 去重,当然要有equals()和hashCode()方法支持了</span></div><div class="line">    .limit(<span class="number">3</span>)<span class="comment">// 只取满足条件的前三个</span></div><div class="line">    .forEach(System.out::println);<span class="comment">// 消费流</span></div></pre></td></tr></table></figure>
<h2 id="map-flatMap"><a href="#map-flatMap" class="headerlink" title="map/flatMap"></a>map/flatMap</h2><p>Stream的map定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;R&gt; <span class="function">Stream&lt;R&gt; <span class="title">map</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ? extends R&gt; mapper)</span></span>;</div></pre></td></tr></table></figure>
<p>也就是说，接收一个输入(T:当前正在迭代的元素)，输出另一种类型(R)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Stream.of(<span class="keyword">null</span>, <span class="string">"apache"</span>, <span class="keyword">null</span>, <span class="string">"apache"</span>, <span class="string">"apache"</span>, <span class="comment">//</span></div><div class="line">          <span class="string">"hadoop"</span>, <span class="string">"linux"</span>, <span class="string">"spark"</span>, <span class="string">"alifafa"</span>)<span class="comment">//</span></div><div class="line"></div><div class="line">  .filter(e -&gt; e != <span class="keyword">null</span> &amp;&amp; e.length() &gt; <span class="number">0</span>)<span class="comment">//</span></div><div class="line">  .map(str -&gt; str.charAt(<span class="number">0</span>))<span class="comment">//取出第一个字符</span></div><div class="line">  .forEach(System.out::println);</div></pre></td></tr></table></figure>
<h2 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h2><p>排序也比较直观，有两种：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 按照元素的Comparable接口的实现来排序</span></div><div class="line"><span class="function">Stream&lt;T&gt; <span class="title">sorted</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 指定Comparator来自定义排序</span></div><div class="line"><span class="function">Stream&lt;T&gt; <span class="title">sorted</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> T&gt; comparator)</span></span>;</div></pre></td></tr></table></figure>
<p>示例:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">List&lt;HouseInfo&gt; houseInfos = Lists.newArrayList(<span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">1</span>, <span class="string">"恒大星级公寓"</span>, <span class="number">100</span>, <span class="number">1</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">2</span>, <span class="string">"汇智湖畔"</span>, <span class="number">999</span>, <span class="number">2</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">3</span>, <span class="string">"张江汤臣豪园"</span>, <span class="number">100</span>, <span class="number">1</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">4</span>, <span class="string">"保利星苑"</span>, <span class="number">23</span>, <span class="number">10</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">5</span>, <span class="string">"北顾小区"</span>, <span class="number">66</span>, <span class="number">23</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">6</span>, <span class="string">"北杰公寓"</span>, <span class="keyword">null</span>, <span class="number">55</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">7</span>, <span class="string">"保利星苑"</span>, <span class="number">77</span>, <span class="number">66</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">8</span>, <span class="string">"保利星苑"</span>, <span class="number">111</span>, <span class="number">12</span>)<span class="comment">//</span></div><div class="line">);</div><div class="line"></div><div class="line">houseInfos.stream().sorted((h1, h2) -&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (h1 == <span class="keyword">null</span> || h2 == <span class="keyword">null</span>)</div><div class="line">      <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span> (h1.getDistance() == <span class="keyword">null</span> || h2.getDistance() == <span class="keyword">null</span>)</div><div class="line">      <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> ret = h1.getDistance().compareTo(h2.getDistance());</div><div class="line">    <span class="keyword">if</span> (ret == <span class="number">0</span>) &#123;</div><div class="line">      <span class="keyword">if</span> (h1.getBrowseCount() == <span class="keyword">null</span> || h2.getBrowseCount() == <span class="keyword">null</span>)</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">      <span class="keyword">return</span> h1.getBrowseCount().compareTo(h2.getBrowseCount());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h1 id="3-终止-消费Stream"><a href="#3-终止-消费Stream" class="headerlink" title="3 终止/消费Stream"></a>3 终止/消费Stream</h1><h2 id="条件测试、初级统计操作"><a href="#条件测试、初级统计操作" class="headerlink" title="条件测试、初级统计操作"></a>条件测试、初级统计操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</div><div class="line"></div><div class="line"><span class="comment">// 是不是所有元素都大于零</span></div><div class="line">System.out.println(list.stream().allMatch(e -&gt; e &gt; <span class="number">0</span>));</div><div class="line"><span class="comment">// 是不是存在偶数</span></div><div class="line">System.out.println(list.stream().anyMatch(e -&gt; (e &amp; <span class="number">1</span>) == <span class="number">0</span>));</div><div class="line"><span class="comment">// 是不是都不小于零</span></div><div class="line">System.out.println(list.stream().noneMatch(e -&gt; e &lt; <span class="number">0</span>));</div><div class="line"></div><div class="line"><span class="comment">// 找出第一个大于等于4的元素</span></div><div class="line">Optional&lt;Integer&gt; optional = list.stream().filter(e -&gt; e &gt;= <span class="number">4</span>).findFirst();</div><div class="line"><span class="comment">// 如果存在的话,就执行ifPresent中指定的操作</span></div><div class="line">optional.ifPresent(System.out::println);</div><div class="line"></div><div class="line"><span class="comment">// 大于等于4的元素的个数</span></div><div class="line">System.out.println(list.stream().filter(e -&gt; e &gt;= <span class="number">4</span>).count());</div><div class="line"><span class="comment">// 获取最小的</span></div><div class="line">System.out.println(list.stream().min(Integer::compareTo));</div><div class="line"><span class="comment">// 获取最大的</span></div><div class="line">System.out.println(list.stream().max(Integer::compareTo));</div><div class="line"><span class="comment">// 先转换成IntStream,max就不需要比较器了</span></div><div class="line">System.out.println(list.stream().mapToInt(i -&gt; i).max());</div></pre></td></tr></table></figure>
<h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><p>这个词不知道怎么翻译，有人翻译为 <code>规约</code> 或 <code>汇聚</code>。</p>
<p>反正就是将经过一系列转换后的流中的数据最终收集起来，收集的同时可能会反复 <code>apply</code> 某个 <code>reduce函数</code>。</p>
<p>reduce()方法有以下两个重载的变体：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 返回的不是Optional,因为正常情况下至少有参数identity可以保证返回值不会为null</span></div><div class="line"><span class="function">T <span class="title">reduce</span><span class="params">(T identity, BinaryOperator&lt;T&gt; accumulator)</span></span>;</div><div class="line"></div><div class="line">&lt;U&gt; <span class="function">U <span class="title">reduce</span><span class="params">(U identity,</span></span></div><div class="line"><span class="function"><span class="params">             BiFunction&lt;U, ? <span class="keyword">super</span> T, U&gt; accumulator,</span></span></div><div class="line"><span class="function"><span class="params">             BinaryOperator&lt;U&gt; combiner)</span></span>;</div></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 遍历元素，反复apply (i,j)-&gt;i+j的操作</span></div><div class="line">Integer reduce = Stream.iterate(<span class="number">1</span>, i -&gt; i + <span class="number">1</span>)<span class="comment">//1,2,3,...,10,...</span></div><div class="line">    .limit(<span class="number">10</span>)<span class="comment">//</span></div><div class="line">    .reduce(<span class="number">0</span>, (i, j) -&gt; i + j);<span class="comment">//55</span></div><div class="line"></div><div class="line"></div><div class="line">Optional&lt;Integer&gt; reduce2 = Stream.iterate(<span class="number">1</span>, i -&gt; i + <span class="number">1</span>)<span class="comment">//</span></div><div class="line">    .limit(<span class="number">10</span>)<span class="comment">//</span></div><div class="line">    .reduce((i, j) -&gt; i + j);</div></pre></td></tr></table></figure>
<h2 id="collect"><a href="#collect" class="headerlink" title="collect"></a>collect</h2><p>该操作很好理解，顾名思义就是将Stream中的元素collect到一个地方。</p>
<ul>
<li>最常规(最不常用)的collect方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 最牛逼的往往是最不常用的,毕竟这个方法理解起来太过复杂了</span></div><div class="line">&lt;R&gt; <span class="function">R <span class="title">collect</span><span class="params">(Supplier&lt;R&gt; supplier,</span></span></div><div class="line"><span class="function"><span class="params">              BiConsumer&lt;R, ? <span class="keyword">super</span> T&gt; accumulator,</span></span></div><div class="line"><span class="function"><span class="params">              BiConsumer&lt;R, R&gt; combiner)</span></span>;</div><div class="line"><span class="comment">// 至于这个方法的参数含义，请看下面的例子</span></div></pre></td></tr></table></figure>
<ul>
<li>一个参数的版本</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;R, A&gt; <span class="function">R <span class="title">collect</span><span class="params">(Collector&lt;? <span class="keyword">super</span> T, A, R&gt; collector)</span></span>;</div></pre></td></tr></table></figure>
<p>Collector接口(他不是函数式接口，没法使用lambda)的关键代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Collector</span>&lt;<span class="title">T</span>, <span class="title">A</span>, <span class="title">R</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function">Supplier&lt;A&gt; <span class="title">supplier</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * </span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function">BiConsumer&lt;A, T&gt; <span class="title">accumulator</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * </span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function">BinaryOperator&lt;A&gt; <span class="title">combiner</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function">Function&lt;A, R&gt; <span class="title">finisher</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * </span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function">Set&lt;Characteristics&gt; <span class="title">characteristics</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>先来看一个关于三个参数的collect()方法的例子，除非特殊情况，不然我保证你看了之后这辈子都不想用它……</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</div><div class="line">ArrayList&lt;Integer&gt; ret1 = numbers.stream()<span class="comment">//</span></div><div class="line">    .map(i -&gt; i * <span class="number">2</span>)<span class="comment">// 扩大两倍</span></div><div class="line">    .collect(<span class="comment">//</span></div><div class="line">    () -&gt; <span class="keyword">new</span> ArrayList&lt;Integer&gt;(), <span class="comment">//参数1</span></div><div class="line">    (list, e) -&gt; list.add(e), <span class="comment">//参数2</span></div><div class="line">    (list1, list2) -&gt; list1.addAll(list2)<span class="comment">//参数3</span></div><div class="line">);</div><div class="line"></div><div class="line"><span class="comment">/***</span></div><div class="line"><span class="comment"> * &lt;pre&gt;</span></div><div class="line"><span class="comment"> * collect()方法的三个参数解释如下：</span></div><div class="line"><span class="comment"> * 1. () -&gt; new ArrayList&lt;Integer&gt;() </span></div><div class="line"><span class="comment"> * 		生成一个新的用来存储结果的集合</span></div><div class="line"><span class="comment"> * 2. (list, e) -&gt; list.add(e)</span></div><div class="line"><span class="comment"> * 		list：是参数1中生成的新集合</span></div><div class="line"><span class="comment"> * 		e：是Stream中正在被迭代的当前元素</span></div><div class="line"><span class="comment"> * 		该参数的作用就是将元素添加到新生成的集合中</span></div><div class="line"><span class="comment"> * 3. (list1, list2) -&gt; list1.addAll(list2)</span></div><div class="line"><span class="comment"> * 		合并集合</span></div><div class="line"><span class="comment"> * &lt;/pre&gt;</span></div><div class="line"><span class="comment"> ***/</span></div><div class="line"></div><div class="line">ret1.forEach(System.out::println);</div></pre></td></tr></table></figure>
<p>不使用lambda的时候，等价的代码应该是这个样子的……</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; ret3 = numbers.stream()<span class="comment">//</span></div><div class="line">    .map(i -&gt; i * <span class="number">2</span>)<span class="comment">// 扩大两倍</span></div><div class="line">    .collect(<span class="keyword">new</span> Supplier&lt;List&lt;Integer&gt;&gt;() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 只是为了提供一个集合来存储元素</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">      &#125;</div><div class="line">    &#125;, <span class="keyword">new</span> BiConsumer&lt;List&lt;Integer&gt;, Integer&gt;() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(List&lt;Integer&gt; list, Integer e)</span> </span>&#123;</div><div class="line">        <span class="comment">// 将当前元素添加至第一个参数返回的容器中</span></div><div class="line">        list.add(e);</div><div class="line">      &#125;</div><div class="line">    &#125;, <span class="keyword">new</span> BiConsumer&lt;List&lt;Integer&gt;, List&lt;Integer&gt;&gt;() &#123;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(List&lt;Integer&gt; list1, List&lt;Integer&gt; list2)</span> </span>&#123;</div><div class="line">        <span class="comment">// 合并容器</span></div><div class="line">        list1.addAll(list2);</div><div class="line">      &#125;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">ret3.forEach(System.out::println);</div></pre></td></tr></table></figure>
<p>是不是被恶心到了……</p>
<p>同样的，用Java调用spark的api的时候，如果没有lambda的话，比上面的代码还恶心……</p>
<p>顺便打个免费的广告，可以看看本大侠这篇使用各种版本实现的Spark的HelloWorld: <a href="http://blog.csdn.net/hylexus/article/details/52606540，来证明一下有lambda的世界是有多么幸福……" target="_blank" rel="external">http://blog.csdn.net/hylexus/article/details/52606540，来证明一下有lambda的世界是有多么幸福……</a></p>
<p>不过，当你理解了三个参数的collect方法之后，可以使用构造器引用和方法引用来使代码更简洁：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ArrayList&lt;Integer&gt; ret2 = numbers.stream()<span class="comment">//</span></div><div class="line">    .map(i -&gt; i * <span class="number">2</span>)<span class="comment">// 扩大两倍</span></div><div class="line">    .collect(<span class="comment">//</span></div><div class="line">    ArrayList::<span class="keyword">new</span>, <span class="comment">//</span></div><div class="line">    List::add, <span class="comment">//</span></div><div class="line">    List::addAll<span class="comment">//</span></div><div class="line">);</div><div class="line"></div><div class="line">ret2.forEach(System.out::println);</div></pre></td></tr></table></figure>
<h2 id="Collectors工具的使用-高级统计操作"><a href="#Collectors工具的使用-高级统计操作" class="headerlink" title="Collectors工具的使用(高级统计操作)"></a>Collectors工具的使用(高级统计操作)</h2><p>上面的三个和一个参数的collect()方法都异常复杂，最常用的还是一个参数的版本。但是那个Collector自己实现的话还是很恶心。</p>
<p>还好，常用的Collect操作对应的Collector都在<code>java.util.stream.Collectors</code> 中提供了。很强大的工具……</p>
<p>以下示例都是对该list的操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">List&lt;HouseInfo&gt; houseInfos = Lists.newArrayList(<span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">1</span>, <span class="string">"恒大星级公寓"</span>, <span class="number">100</span>, <span class="number">1</span>), <span class="comment">// 小区ID，小区名，浏览数，距离</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">2</span>, <span class="string">"汇智湖畔"</span>, <span class="number">999</span>, <span class="number">2</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">3</span>, <span class="string">"张江汤臣豪园"</span>, <span class="number">100</span>, <span class="number">1</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">4</span>, <span class="string">"保利星苑"</span>, <span class="number">111</span>, <span class="number">10</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">5</span>, <span class="string">"北顾小区"</span>, <span class="number">66</span>, <span class="number">23</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">6</span>, <span class="string">"北杰公寓"</span>, <span class="number">77</span>, <span class="number">55</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">7</span>, <span class="string">"保利星苑"</span>, <span class="number">77</span>, <span class="number">66</span>), <span class="comment">//</span></div><div class="line">    <span class="keyword">new</span> HouseInfo(<span class="number">8</span>, <span class="string">"保利星苑"</span>, <span class="number">111</span>, <span class="number">12</span>)<span class="comment">//</span></div><div class="line">);</div></pre></td></tr></table></figure>
<p>好了，开始装逼之旅 ^_^   ……</p>
<ul>
<li>提取小区名</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取所有小区名，放到list中</span></div><div class="line">List&lt;String&gt; ret1 = houseInfos.stream()</div><div class="line">  	.map(HouseInfo::getHouseName).collect(Collectors.toList());</div><div class="line">ret1.forEach(System.out::println);</div><div class="line"></div><div class="line"><span class="comment">// 获取所有的小区名，放到set中去重</span></div><div class="line"><span class="comment">// 当然也可先distinct()再collect到List中</span></div><div class="line">Set&lt;String&gt; ret2 = houseInfos.stream()</div><div class="line">  	.map(HouseInfo::getHouseName).collect(Collectors.toSet());</div><div class="line">ret2.forEach(System.out::println);</div><div class="line"></div><div class="line"><span class="comment">// 将所有的小区名用_^_连接起来</span></div><div class="line"><span class="comment">// 恒大星级公寓_^_汇智湖畔_^_张江汤臣豪园_^_保利星苑_^_北顾小区_^_北杰公寓_^_保利星苑_^_保利星苑</span></div><div class="line">String names = houseInfos.stream()</div><div class="line">  	.map(HouseInfo::getHouseName).collect(Collectors.joining(<span class="string">"_^_"</span>));</div><div class="line">System.out.println(names);</div><div class="line"></div><div class="line"><span class="comment">// 指定集合类型为ArrayList</span></div><div class="line">ArrayList&lt;String&gt; collect = houseInfos.stream()</div><div class="line">  	.map(HouseInfo::getHouseName)</div><div class="line">  	.collect(Collectors.toCollection(ArrayList::<span class="keyword">new</span>));</div></pre></td></tr></table></figure>
<ul>
<li>最值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取浏览数最高的小区</span></div><div class="line">Optional&lt;HouseInfo&gt; ret3 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getBrowseCount() != <span class="keyword">null</span>)<span class="comment">// 过滤掉浏览数为空的</span></div><div class="line">  .collect(Collectors.maxBy((h1, h2) -&gt; Integer.compare(h1.getBrowseCount(), h2.getBrowseCount())));</div><div class="line">System.out.println(ret3.get());</div><div class="line"></div><div class="line"><span class="comment">// 获取最高浏览数</span></div><div class="line">Optional&lt;Integer&gt; ret4 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getBrowseCount() != <span class="keyword">null</span>)<span class="comment">// 去掉浏览数为空的</span></div><div class="line">  .map(HouseInfo::getBrowseCount)<span class="comment">// 取出浏览数</span></div><div class="line">  .collect(Collectors.maxBy(Integer::compare));<span class="comment">// 方法引用，比较浏览数</span></div><div class="line">System.out.println(ret4.get());</div></pre></td></tr></table></figure>
<ul>
<li>总数、总和</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取总数</span></div><div class="line"><span class="comment">// 其实这个操作直接用houseInfos.size()就可以了，此处仅为演示语法</span></div><div class="line">Long total = houseInfos.stream().collect(Collectors.counting());</div><div class="line">System.out.println(total);</div><div class="line"></div><div class="line"><span class="comment">// 浏览数总和</span></div><div class="line">Integer ret5 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getBrowseCount() != <span class="keyword">null</span>)<span class="comment">// 过滤掉浏览数为空的</span></div><div class="line">  .collect(Collectors.summingInt(HouseInfo::getBrowseCount));</div><div class="line">System.out.println(ret5);</div><div class="line"></div><div class="line"><span class="comment">// 浏览数总和</span></div><div class="line">Integer ret6 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getBrowseCount() != <span class="keyword">null</span>)<span class="comment">// 过滤掉浏览数为空的</span></div><div class="line">  .map(HouseInfo::getBrowseCount).collect(Collectors.summingInt(i -&gt; i));</div><div class="line">System.out.println(ret6);</div><div class="line"></div><div class="line"><span class="comment">// 浏览数总和</span></div><div class="line"><span class="keyword">int</span> ret7 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getBrowseCount() != <span class="keyword">null</span>)<span class="comment">// 过滤掉浏览数为空的</span></div><div class="line">  .mapToInt(HouseInfo::getBrowseCount)<span class="comment">// 先转换为IntStream后直接用其sum()方法</span></div><div class="line">  .sum();</div><div class="line">System.out.println(ret7);</div></pre></td></tr></table></figure>
<ul>
<li>均值</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 浏览数平均值</span></div><div class="line">Double ret8 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getBrowseCount() != <span class="keyword">null</span>)<span class="comment">// 过滤掉浏览数为空的</span></div><div class="line">  .collect(Collectors.averagingDouble(HouseInfo::getBrowseCount));</div><div class="line">System.out.println(ret8);</div><div class="line"></div><div class="line"><span class="comment">// 浏览数平均值</span></div><div class="line">OptionalDouble ret9 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getBrowseCount() != <span class="keyword">null</span>)<span class="comment">// 过滤掉浏览数为空的</span></div><div class="line">  .mapToDouble(HouseInfo::getBrowseCount)<span class="comment">// 先转换为DoubleStream后直接用其average()方法</span></div><div class="line">  .average();</div><div class="line">System.out.println(ret9.getAsDouble());</div></pre></td></tr></table></figure>
<ul>
<li>统计信息</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 获取统计信息</span></div><div class="line">DoubleSummaryStatistics statistics = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getBrowseCount() != <span class="keyword">null</span>)</div><div class="line">  .collect(Collectors.summarizingDouble(HouseInfo::getBrowseCount));</div><div class="line">System.out.println(<span class="string">"avg:"</span> + statistics.getAverage());</div><div class="line">System.out.println(<span class="string">"max:"</span> + statistics.getMax());</div><div class="line">System.out.println(<span class="string">"sum:"</span> + statistics.getSum());</div></pre></td></tr></table></figure>
<ul>
<li>分组</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 按浏览数分组</span></div><div class="line">Map&lt;Integer, List&lt;HouseInfo&gt;&gt; ret10 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getBrowseCount() != <span class="keyword">null</span>)<span class="comment">// 过滤掉浏览数为空的</span></div><div class="line">  .collect(Collectors.groupingBy(HouseInfo::getBrowseCount));</div><div class="line">ret10.forEach((count, house) -&gt; &#123;</div><div class="line">  System.out.println(<span class="string">"BrowseCount:"</span> + count + <span class="string">" "</span> + house);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 多级分组</span></div><div class="line"><span class="comment">// 先按浏览数分组,二级分组用距离分组</span></div><div class="line">Map&lt;Integer, Map&lt;String, List&lt;HouseInfo&gt;&gt;&gt; ret11 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getBrowseCount() != <span class="keyword">null</span> &amp;&amp; h.getDistance() != <span class="keyword">null</span>)<span class="comment">//</span></div><div class="line">  .collect(Collectors.groupingBy(</div><div class="line">      HouseInfo::getBrowseCount,</div><div class="line">      Collectors.groupingBy((HouseInfo h) -&gt; &#123;</div><div class="line">          <span class="keyword">if</span> (h.getDistance() &lt;= <span class="number">10</span>)</div><div class="line">            <span class="keyword">return</span> <span class="string">"较近"</span>;</div><div class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (h.getDistance() &lt;= <span class="number">20</span>)</div><div class="line">            <span class="keyword">return</span> <span class="string">"近"</span>;</div><div class="line">          <span class="keyword">return</span> <span class="string">"较远"</span>;</div><div class="line">    &#125;)));</div><div class="line"></div><div class="line"><span class="comment">//结果大概长这样</span></div><div class="line">ret11.forEach((count, v) -&gt; &#123;</div><div class="line">  System.out.println(<span class="string">"浏览数:"</span> + count);</div><div class="line">  v.forEach((desc, houses) -&gt; &#123;</div><div class="line">    System.out.println(<span class="string">"\t"</span> + desc);</div><div class="line">    houses.forEach(h -&gt; System.out.println(<span class="string">"\t\t"</span> + h));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"><span class="comment">/****</span></div><div class="line"><span class="comment"> * &lt;pre&gt;</span></div><div class="line"><span class="comment"> *  浏览数:66</span></div><div class="line"><span class="comment">		较远</span></div><div class="line"><span class="comment">			HouseInfo [houseId=5, houseName=北顾小区, browseCount=66, distance=23]</span></div><div class="line"><span class="comment">	浏览数:100</span></div><div class="line"><span class="comment">		较近</span></div><div class="line"><span class="comment">			HouseInfo [houseId=1, houseName=恒大星级公寓, browseCount=100, distance=1]</span></div><div class="line"><span class="comment">			HouseInfo [houseId=3, houseName=张江汤臣豪园, browseCount=100, distance=1]</span></div><div class="line"><span class="comment">	浏览数:999</span></div><div class="line"><span class="comment">		较近</span></div><div class="line"><span class="comment">			HouseInfo [houseId=2, houseName=汇智湖畔, browseCount=999, distance=2]</span></div><div class="line"><span class="comment">	浏览数:77</span></div><div class="line"><span class="comment">		较远</span></div><div class="line"><span class="comment">			HouseInfo [houseId=6, houseName=北杰公寓, browseCount=77, distance=55]</span></div><div class="line"><span class="comment">			HouseInfo [houseId=7, houseName=保利星苑, browseCount=77, distance=66]</span></div><div class="line"><span class="comment">	浏览数:111</span></div><div class="line"><span class="comment">		近</span></div><div class="line"><span class="comment">			HouseInfo [houseId=8, houseName=保利星苑, browseCount=111, distance=12]</span></div><div class="line"><span class="comment">		较近</span></div><div class="line"><span class="comment">			HouseInfo [houseId=4, houseName=保利星苑, browseCount=111, distance=10]</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> * &lt;/pre&gt;</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> ****/</span></div></pre></td></tr></table></figure>
<ul>
<li>分区</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 按距离分区(两部分)</span></div><div class="line">Map&lt;Boolean, List&lt;HouseInfo&gt;&gt; ret12 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getDistance() != <span class="keyword">null</span>)<span class="comment">//</span></div><div class="line">  .collect(Collectors.partitioningBy(h -&gt; h.getDistance() &lt;= <span class="number">20</span>));</div><div class="line"><span class="comment">/****</span></div><div class="line"><span class="comment">		 * &lt;pre&gt;</span></div><div class="line"><span class="comment">		 *  较远</span></div><div class="line"><span class="comment">					HouseInfo [houseId=5, houseName=北顾小区, browseCount=66, distance=23]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=6, houseName=北杰公寓, browseCount=77, distance=55]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=7, houseName=保利星苑, browseCount=77, distance=66]</span></div><div class="line"><span class="comment">			较近</span></div><div class="line"><span class="comment">					HouseInfo [houseId=1, houseName=恒大星级公寓, browseCount=100, distance=1]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=2, houseName=汇智湖畔, browseCount=999, distance=2]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=3, houseName=张江汤臣豪园, browseCount=100, distance=1]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=4, houseName=保利星苑, browseCount=111, distance=10]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=8, houseName=保利星苑, browseCount=111, distance=12]</span></div><div class="line"><span class="comment">		 * </span></div><div class="line"><span class="comment">		 * &lt;/pre&gt;</span></div><div class="line"><span class="comment">		 ****/</span></div><div class="line">ret12.forEach((t, houses) -&gt; &#123;</div><div class="line">  System.out.println(t ? <span class="string">"较近"</span> : <span class="string">"较远"</span>);</div><div class="line">  houses.forEach(h -&gt; System.out.println(<span class="string">"\t\t"</span> + h));</div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line">Map&lt;Boolean, Map&lt;Boolean, List&lt;HouseInfo&gt;&gt;&gt; ret13 = houseInfos.stream()<span class="comment">//</span></div><div class="line">  .filter(h -&gt; h.getDistance() != <span class="keyword">null</span>)<span class="comment">//</span></div><div class="line">  .collect(</div><div class="line">  		Collectors.partitioningBy(h -&gt; h.getDistance() &lt;= <span class="number">20</span>,</div><div class="line">        Collectors.partitioningBy(h -&gt; h.getBrowseCount() &gt;= <span class="number">70</span>))</div><div class="line">);</div><div class="line"></div><div class="line"><span class="comment">/*****</span></div><div class="line"><span class="comment">		 * &lt;pre&gt;</span></div><div class="line"><span class="comment">		 *  较远</span></div><div class="line"><span class="comment">				浏览较少</span></div><div class="line"><span class="comment">					HouseInfo [houseId=5, houseName=北顾小区, browseCount=66, distance=23]</span></div><div class="line"><span class="comment">				浏览较多</span></div><div class="line"><span class="comment">					HouseInfo [houseId=6, houseName=北杰公寓, browseCount=77, distance=55]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=7, houseName=保利星苑, browseCount=77, distance=66]</span></div><div class="line"><span class="comment">			较近</span></div><div class="line"><span class="comment">				浏览较少</span></div><div class="line"><span class="comment">				浏览较多</span></div><div class="line"><span class="comment">					HouseInfo [houseId=1, houseName=恒大星级公寓, browseCount=100, distance=1]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=2, houseName=汇智湖畔, browseCount=999, distance=2]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=3, houseName=张江汤臣豪园, browseCount=100, distance=1]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=4, houseName=保利星苑, browseCount=111, distance=10]</span></div><div class="line"><span class="comment">					HouseInfo [houseId=8, houseName=保利星苑, browseCount=111, distance=12]</span></div><div class="line"><span class="comment">		 * &lt;/pre&gt;</span></div><div class="line"><span class="comment">		 ****/</span></div><div class="line"></div><div class="line">ret13.forEach((less, value) -&gt; &#123;</div><div class="line">  System.out.println(less ? <span class="string">"较近"</span> : <span class="string">"较远"</span>);</div><div class="line">  value.forEach((moreCount, houses) -&gt; &#123;</div><div class="line">    System.out.println(moreCount ? <span class="string">"\t浏览较多"</span> : <span class="string">"\t浏览较少"</span>);</div><div class="line">    houses.forEach(h -&gt; System.out.println(<span class="string">"\t\t"</span> + h));</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></div><div class="tags"><a href="/tags/lambda/">lambda</a></div><div class="post-nav"><a href="/2017/07/25/java8-04-其他特性/" class="pre">java8-04-其他特性</a><a href="/2017/05/01/kafka-05-java客户端操作kafka/" class="next"></a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/99-problems-in-scala/">99-problems-in-scala</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-多线程/">Java-多线程</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaSE/">JavaSE</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode/">LeetCode</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NIO/">NIO</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/app-server/">app-server</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/http-server/">http-server</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/logging/">logging</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring-cloud/">spring-cloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/排序/">排序</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/LeetCode/" style="font-size: 15px;">LeetCode</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/apache-httpd/" style="font-size: 15px;">apache/httpd</a> <a href="/tags/lambda/" style="font-size: 15px;">lambda</a> <a href="/tags/bit/" style="font-size: 15px;">bit</a> <a href="/tags/keytool/" style="font-size: 15px;">keytool</a> <a href="/tags/非对称加密/" style="font-size: 15px;">非对称加密</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/jt-808/" style="font-size: 15px;">jt-808</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/logging/" style="font-size: 15px;">logging</a> <a href="/tags/scala/" style="font-size: 15px;">scala</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/spring-cloud/" style="font-size: 15px;">spring-cloud</a> <a href="/tags/ssh/" style="font-size: 15px;">ssh</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/排序/" style="font-size: 15px;">排序</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/java多线程-01-基本概念/">java多线程-01-基本概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/排序算法-01-冒泡排序/">排序算法-01-冒泡排序排序算法-01-冒泡排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/git-01-简介、安装和配置/">git-01-简介、安装和配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/git-02-基本操作/">git-02-基本操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/git-03-分支/">git-03-分支</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/shiro-常用filter/">shiro-常用filter</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/problem01-05/">problem01-05</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/java秘钥、证书管理工具-keytool/">java秘钥、证书管理工具-keytool</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/docker筑基篇-00-docker简介/">docker筑基篇-00-docker简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/httpd系列-00-安装/">httpd系列-00-安装</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">宛丘.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>